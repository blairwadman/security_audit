<?php
/**
 * @file
 * Module file for security audit
 */

/**
 * Implements hook_menu().
 *
 *
 */
function security_audit_menu() {
  $items['security_audit/test'] = array(
    'title' => 'blogs',
    'page callback' => 'blog_page',
    'access arguments' => array('access content'),
    'type' => MENU_SUGGESTED_ITEM,
  );
  $items['security_audit/welcome/%'] = array(
    'title' => 'Welcome',
    'page callback' => 'security_audit_welcome_callback',
    'page arguments' => array(2),
    'access arguments' => array('access content'),
    'type' => MENU_CALLBACK,
  );

  $items['security_audit/node/%'] = array(
    'title' => 'Display a node',
    'page callback' => 'security_audit_node_callback',
    'page arguments' => array(2),
    'access arguments' => array('access content'),
    'type' => MENU_CALLBACK,
  );

  return $items;
  
}

/**
 * Callback which displays simple hello message
 * @param $name
 * @return string
 */
function security_audit_welcome_callback($name) {
  // Security problem: user input is not being sanitised and passed directly to the browser.
  $output = 'Hello '.$name;

  return $output;
}

/**
 * Callback which displays a node
 */
function security_audit_node_callback($nid) {
  // View of node

  // Example if SQL Injection. User can pass in another SQL query to alter the query below.
  $nid = $_GET['nid'];
  $title = db_query("SELECT title FROM node where nid = $nid")->fetchField();

  return $title;
}